# CLI ä½¿ç”¨æ‰‹å†Š

æœ¬æ–‡ä»¶åˆ—å‡º `npm run` æŒ‡ä»¤çš„èªªæ˜èˆ‡ç¯„ä¾‹ã€‚å®Œæ•´çš„åƒæ•¸åˆ—è¡¨å¯é€é `npm run <command> -- --help` æŸ¥çœ‹ã€‚

## å»ºç½®èˆ‡é–‹ç™¼

- `npm run build`ï¼šç·¨è­¯ TypeScript å°ˆæ¡ˆã€‚

```bash
npm run build
```

- `npm run dev`ï¼šä»¥ tsx åŸ·è¡Œ `src/index.ts`ï¼Œæ–¹ä¾¿é–‹ç™¼ã€‚

```bash
npm run dev
```

## è³‡æ–™æŠ“å–

- `npm run update-stock-list`ï¼šæ›´æ–°è‚¡ç¥¨æ¸…å–®ï¼Œå¾ TWSE API å–å¾—æœ€æ–°çš„ä¸Šå¸‚ä¸Šæ«ƒè‚¡ç¥¨è³‡æ–™ã€‚

```bash
# è‡ªå‹•æª¢æŸ¥ä¸¦æ›´æ–°è‚¡ç¥¨æ¸…å–®ï¼ˆå¦‚æœè¶…é 24 å°æ™‚ï¼‰
npm run update-stock-list

# å¼·åˆ¶æ›´æ–°è‚¡ç¥¨æ¸…å–®
npm run update-stock-list -- --force
```

- `npm run list-stocks`ï¼šæŸ¥çœ‹è‚¡ç¥¨æ¸…å–®ï¼Œæ”¯æ´æ¢ä»¶ç¯©é¸ã€åˆ†æ•¸è¨ˆç®—èˆ‡åŒ¯å‡ºåŠŸèƒ½ã€‚

```bash
# æŸ¥çœ‹æ‰€æœ‰è‚¡ç¥¨åŸºæœ¬è³‡è¨Š
npm run list-stocks

# ç¯©é¸ä¸Šå¸‚è‚¡ç¥¨ï¼Œé™åˆ¶é¡¯ç¤º 20 æ”¯
npm run list-stocks -- --market ä¸Šå¸‚ --limit 20

# ç¯©é¸åŠå°é«”ç”¢æ¥­è‚¡ç¥¨
npm run list-stocks -- --industry åŠå°é«”

# è¨ˆç®—ä¸¦é¡¯ç¤ºè‚¡ç¥¨åˆ†æ•¸ï¼ˆè¼ƒè€—æ™‚ï¼‰
npm run list-stocks -- --show-scores --limit 10

# åªé¡¯ç¤ºåˆ†æ•¸å¤§æ–¼ 70 çš„è‚¡ç¥¨
npm run list-stocks -- --show-scores --min-score 70

# åŒ¯å‡ºç‚º CSV æª”æ¡ˆ
npm run list-stocks -- --show-scores --export csv --limit 50

# åŒ¯å‡ºç‚º JSON æª”æ¡ˆ
npm run list-stocks -- --export json
```

- `npm run fetch-all`ï¼šä¸€æ¬¡æŠ“å–æ‰€æœ‰å› å­èˆ‡åƒ¹æ ¼è³‡æ–™ã€‚ç¾åœ¨æœƒè‡ªå‹•æª¢æŸ¥ä¸¦æ›´æ–°è‚¡ç¥¨æ¸…å–®ï¼Œç„¶å¾Œç‚ºæ‰€æœ‰è‚¡ç¥¨æŠ“å–è³‡æ–™ã€‚

**ğŸ”„ é€²åº¦è¿½è¹¤èˆ‡æ–·é»çºŒå‚³**
- è‡ªå‹•è¨˜éŒ„æŠ“å–é€²åº¦ï¼Œç•¶ FinMind API é…é¡ç”¨ç›¡æ™‚æœƒæš«åœä¸¦å„²å­˜é€²åº¦
- ä¸‹æ¬¡åŸ·è¡Œæ™‚æœƒè‡ªå‹•å¾ä¸Šæ¬¡ä¸­æ–·çš„åœ°æ–¹ç¹¼çºŒ
- é€²åº¦æª”æ¡ˆå„²å­˜æ–¼ `data/progress_fetch-all.json`

æ”¯æ´åƒæ•¸ï¼š
- `--market` (æˆ– `-m`)ï¼šæŒ‡å®šå¸‚å ´é¡å‹
  - `tse`ï¼šåƒ…æŠ“å–ä¸Šå¸‚è‚¡ç¥¨
  - `otc`ï¼šåƒ…æŠ“å–ä¸Šæ«ƒè‚¡ç¥¨
  - `emerging`ï¼šåƒ…æŠ“å–èˆˆæ«ƒè‚¡ç¥¨
  - `all`ï¼šæŠ“å–æ‰€æœ‰è‚¡ç¥¨ï¼ˆé è¨­å€¼ï¼‰
- `--stocks` (æˆ– `-s`)ï¼šæŒ‡å®šç‰¹å®šè‚¡ç¥¨ä»£ç¢¼ï¼Œä»¥é€—è™Ÿåˆ†éš”
- `--exclude` (æˆ– `-e`)ï¼šæ’é™¤ç‰¹å®šè‚¡ç¥¨ä»£ç¢¼ï¼Œä»¥é€—è™Ÿåˆ†éš”
- `--resume` (æˆ– `-r`)ï¼šå¾ä¸Šæ¬¡é€²åº¦ç¹¼çºŒï¼ˆé è¨­å•Ÿç”¨ï¼‰
- `--no-resume`ï¼šå¿½ç•¥ä¸Šæ¬¡é€²åº¦ï¼Œå¾é ­é–‹å§‹
- `--clear-progress`ï¼šæ¸…é™¤æ‰€æœ‰é€²åº¦è¨˜éŒ„å¾Œé‡æ–°é–‹å§‹

```bash
# æŠ“å–æ‰€æœ‰è‚¡ç¥¨è³‡æ–™ï¼ˆæœƒè‡ªå‹•å¾é€²åº¦ç¹¼çºŒï¼‰
npm run fetch-all

# å¿½ç•¥é€²åº¦ï¼Œå¾é ­é–‹å§‹æŠ“å–
npm run fetch-all -- --no-resume

# æ¸…é™¤é€²åº¦è¨˜éŒ„å¾Œé‡æ–°é–‹å§‹
npm run fetch-all -- --clear-progress

# åªæŠ“å–ä¸Šå¸‚è‚¡ç¥¨
npm run fetch-all -- --market tse

# åªæŠ“å–ä¸Šæ«ƒè‚¡ç¥¨
npm run fetch-all -- --market otc

# åªæŠ“å–æŒ‡å®šè‚¡ç¥¨
npm run fetch-all -- --stocks 2330,2317,5274

# æŠ“å–ä¸Šå¸‚è‚¡ç¥¨ä½†æ’é™¤å°ç©é›»
npm run fetch-all -- --market tse --exclude 2330

# æŠ“å–å¤šæ”¯æŒ‡å®šè‚¡ç¥¨ï¼ˆä¸Šå¸‚ + ä¸Šæ«ƒï¼‰
npm run fetch-all -- --stocks 2330,2317,5274,6488

# é…é¡ç”¨ç›¡å¾Œï¼Œéš”å¤©ç¹¼çºŒæŠ“å–
npm run fetch-all  # è‡ªå‹•æª¢æ¸¬ä¸¦å¾é€²åº¦ç¹¼çºŒ
```

**ğŸ’¡ é…é¡ç®¡ç†å»ºè­°**
- FinMind å…è²»å¸³è™Ÿæ¯æ—¥æœ‰ API è«‹æ±‚é™åˆ¶
- ç•¶é…é¡ç”¨ç›¡æ™‚ï¼Œç¨‹å¼æœƒè‡ªå‹•æš«åœä¸¦è¨˜éŒ„é€²åº¦
- å»ºè­°æ¯å¤©åŸ·è¡Œä¸€æ¬¡ï¼Œé€æ­¥å®Œæˆæ‰€æœ‰è‚¡ç¥¨çš„è³‡æ–™æ›´æ–°
- å¦‚éœ€å®Œæ•´æŠ“å–å¤§é‡è‚¡ç¥¨ï¼Œå»ºè­°è€ƒæ…® FinMind ä»˜è²»æ–¹æ¡ˆ

- `npm run fetch-valuation`ï¼šæŠ“å–æœ¬ç›Šæ¯”ã€è‚¡åƒ¹æ·¨å€¼æ¯”ç­‰ä¼°å€¼è³‡æ–™ï¼Œå¯ä½¿ç”¨ `--date`ã€`--stocks` ç­‰åƒæ•¸ã€‚

```bash
npm run fetch-valuation -- --date 2024-01-05 --stocks 2330,2303
```

- `npm run fetch-growth`ï¼šæŠ“å–ç‡Ÿæ”¶èˆ‡ EPS æˆé•·è³‡æ–™ï¼Œéœ€è¦ FinMind Tokenã€‚å¯é€é `--type` æŒ‡å®š `revenue`ã€`eps` æˆ– `both`ï¼ˆé è¨­ï¼‰ã€‚æ”¯æ´ `--stocks` æŒ‡å®šè‚¡ç¥¨ä»£ç¢¼æ¸…å–®ï¼Œ`--no-cache` åœç”¨å¿«å–ã€‚

```bash
# æŠ“å–ç‰¹å®šè‚¡ç¥¨çš„ç‡Ÿæ”¶è³‡æ–™
npm run fetch-growth -- --type revenue --stocks 2330,2317

# æŠ“å–æ‰€æœ‰é¡å‹çš„æˆé•·è³‡æ–™ï¼ˆç‡Ÿæ”¶ + EPSï¼‰
npm run fetch-growth -- --type both --stocks 2330

# ä¸ä½¿ç”¨å¿«å–é‡æ–°æŠ“å–
npm run fetch-growth -- --no-cache --stocks 2330
```

- `npm run fetch-quality`ï¼šæŠ“å– ROEã€æ¯›åˆ©ç‡ç­‰è²¡å‹™å“è³ªæŒ‡æ¨™ã€‚

```bash
npm run fetch-quality -- --stock 2330
```

- `npm run fetch-fund-flow`ï¼šæŠ“å–å¤–è³‡ã€æŠ•ä¿¡è²·è³£è¶…ç­‰è³‡é‡‘æµè³‡æ–™ã€‚

```bash
npm run fetch-fund-flow -- --stocks 2330,2317 --start-date 2024-01-01
```

- `npm run fetch-momentum`ï¼šæŠ“å– RSIã€ç§»å‹•å¹³å‡ç­‰å‹•èƒ½æŒ‡æ¨™ï¼Œæ”¯æ´ `--stocks` æŒ‡å®šè‚¡ç¥¨ä»£ç¢¼æ¸…å–®ï¼Œ`--days` æŒ‡å®šè¨ˆç®—å¤©æ•¸ã€‚

```bash
npm run fetch-momentum -- --stocks 2330,2317 --days 60
```

- `npm run fetch-price`ï¼šæŠ“å–è‚¡åƒ¹èˆ‡ä¼°å€¼æ­·å²è³‡æ–™ã€‚

```bash
npm run fetch-price -- --stocks 2330 --days 30 --type price
```

## åˆ†æèˆ‡è¦–è¦ºåŒ–

- `npm run rank`ï¼šè¨ˆç®—è‚¡ç¥¨ç¶œåˆåˆ†æ•¸ä¸¦ä¾åˆ†æ•¸æ’åºã€‚æ”¯æ´å¤šç¨®è©•åˆ†æ–¹æ³•èˆ‡è‡ªè¨‚æ¬Šé‡ã€‚

**ä¸»è¦åƒæ•¸ï¼š**
- `--minScore`ï¼šæœ€ä½åˆ†æ•¸é–€æª»ï¼ˆé è¨­ï¼š0ï¼‰
- `--limit`ï¼šé¡¯ç¤ºè‚¡ç¥¨æ•¸é‡ä¸Šé™ï¼ˆé è¨­ï¼š30ï¼‰
- `--weights`ï¼šè‡ªè¨‚æ¬Šé‡ï¼Œæ ¼å¼ç‚º `valuation,growth,quality,fundflow,momentum`
- `--method`ï¼šè©•åˆ†æ–¹æ³•ï¼Œå¯é¸ `zscore`ï¼ˆé è¨­ï¼‰ã€`percentile`ã€`rolling`
- `--window`ï¼šæ»¾å‹•è¦–çª—æœˆæ•¸ï¼Œç”¨æ–¼ rolling æ–¹æ³•ï¼ˆé è¨­ï¼š3ï¼‰
- `--offline`ï¼šé›¢ç·šæ¨¡å¼ï¼Œåƒ…ä½¿ç”¨å¿«å–è³‡æ–™

```bash
# é¡¯ç¤ºå‰ 10 åï¼Œæœ€ä½åˆ†æ•¸ 70
npm run rank -- --limit 10 --minScore 70

# ä½¿ç”¨è‡ªè¨‚æ¬Šé‡ï¼ˆä¼°å€¼ 50%ï¼Œæˆé•· 30%ï¼Œå“è³ª 20%ï¼‰
npm run rank -- --weights 50,30,20,0,0

# ä½¿ç”¨ç™¾åˆ†ä½æ•¸è©•åˆ†æ–¹æ³•
npm run rank -- --method percentile --limit 20

# é›¢ç·šæ¨¡å¼æ’å
npm run rank -- --offline --limit 15
```

- `npm run explain`ï¼šé¡¯ç¤ºå–®ä¸€è‚¡ç¥¨çš„è©³ç´°æŒ‡æ¨™èˆ‡è©•åˆ†åˆ†è§£ã€‚

```bash
npm run explain 2330
```

- `npm run visualize`ï¼šè¼¸å‡º ASCII åœ–è¡¨æˆ–æ‘˜è¦å ±å‘Šï¼Œæ”¯æ´ `--type`ã€`--stocks` ç­‰åƒæ•¸ã€‚

```bash
npm run visualize -- --type distribution
```

- `npm run backtest`ï¼šæ ¹æ“šæŒ‡å®šç­–ç•¥åŸ·è¡Œå›æ¸¬ã€‚æ”¯æ´å¤šç¨®ç­–ç•¥èˆ‡è©³ç´°çš„æˆæœ¬è¨­å®šã€‚

**ç­–ç•¥é¸é …ï¼š**
- `ma`ï¼šç§»å‹•å¹³å‡ç­–ç•¥ï¼ˆéœ€æŒ‡å®š `--stock`ï¼‰
- `top_n`ï¼šå‰ N åç­–ç•¥ï¼ˆéœ€æŒ‡å®š `-n`ï¼‰
- `threshold`ï¼šé–€æª»ç­–ç•¥ï¼ˆéœ€æŒ‡å®š `--threshold`ï¼‰
- `rank`ï¼šæ’åç­–ç•¥ï¼ˆé è¨­ï¼Œå¯èª¿æ•´å„ç¨®åƒæ•¸ï¼‰

**ä¸»è¦åƒæ•¸ï¼š**
- `--strategy`ï¼šç­–ç•¥é¡å‹ï¼ˆé è¨­ï¼šmaï¼‰
- `--start`ï¼šé–‹å§‹æ—¥æœŸ
- `--end`ï¼šçµæŸæ—¥æœŸ
- `--top`ï¼šæŒæœ‰è‚¡ç¥¨æ•¸é‡ï¼ˆé è¨­ï¼š10ï¼‰
- `--rebalance`ï¼šå†å¹³è¡¡é€±æœŸï¼ˆå¤©æ•¸ï¼Œé è¨­ï¼š21ï¼‰
- `--mode`ï¼šæ¬Šé‡æ¨¡å¼ï¼Œ`equal`ï¼ˆç­‰æ¬Šé‡ï¼‰æˆ– `cap`ï¼ˆå¸‚å€¼æ¬Šé‡ï¼Œé è¨­ï¼šequalï¼‰
- `--cost`ï¼šäº¤æ˜“æˆæœ¬ç‡ï¼ˆé è¨­ï¼š0.001425ï¼‰
- `--fee`ï¼šæ‰‹çºŒè²»ç‡ï¼ˆé è¨­ï¼š0.003ï¼‰
- `--slip`ï¼šæ»‘åƒ¹ç‡ï¼ˆé è¨­ï¼š0.0015ï¼‰

```bash
# åŸºæœ¬æ’åç­–ç•¥å›æ¸¬
npm run backtest -- --strategy rank --start 2018-01-01 --end 2020-12-31

# è©³ç´°åƒæ•¸è¨­å®š
npm run backtest -- --strategy rank --start 2018-01-01 --end 2020-12-31 \
  --top 10 --rebalance 21 --mode equal --cost 0.001425 --fee 0.003 --slip 0.0015

# é–€æª»ç­–ç•¥
npm run backtest -- --strategy threshold --threshold 75 --start 2020-01-01

# å‰ N åç­–ç•¥
npm run backtest -- --strategy top_n -n 5 --start 2020-01-01
```

- `npm run walk-forward`ï¼šåŸ·è¡Œæ»¾å‹•è¦–çª—çš„ Walkâ€‘Forward åˆ†æï¼Œç”¨æ–¼é©—è­‰ç­–ç•¥çš„æ™‚é–“ç©©å®šæ€§ã€‚

**ä¸»è¦åƒæ•¸ï¼š**
- `--start`ï¼šåˆ†æé–‹å§‹æ—¥æœŸ
- `--end`ï¼šåˆ†æçµæŸæ—¥æœŸ
- `--window`ï¼šè¨“ç·´è¦–çª—é•·åº¦ï¼ˆå¹´æ•¸ï¼Œé è¨­ï¼š3ï¼‰
- `--step`ï¼šæ»¾å‹•æ­¥é•·ï¼ˆæœˆæ•¸ï¼Œé è¨­ï¼š1ï¼‰
- å…¶ä»–åƒæ•¸åŒ backtest å‘½ä»¤

```bash
# åŸºæœ¬ Walk-Forward åˆ†æ
npm run walk-forward -- --start 2018-01-01 --end 2020-12-31

# è‡ªè¨‚è¦–çª—èˆ‡æ­¥é•·
npm run walk-forward -- --start 2018-01-01 --end 2020-12-31 \
  --window 3 --step 1 --top 10 --rebalance 21
```

- `npm run optimize`ï¼šæ‰¹é‡æ¸¬è©¦ä¸åŒçš„æŒè‚¡æ•¸ (`--top`) èˆ‡å†å¹³è¡¡é€±æœŸ (`--rebalance`)ï¼Œè¼¸å‡ºæœ€ä½³åŒ–çµæœã€‚

**ä¸»è¦åƒæ•¸ï¼š**
- `--start`ï¼šå›æ¸¬é–‹å§‹æ—¥æœŸ
- `--end`ï¼šå›æ¸¬çµæŸæ—¥æœŸ
- `--top`ï¼šæ¸¬è©¦çš„æŒè‚¡æ•¸é‡æ¸…å–®ï¼ˆé€—è™Ÿåˆ†éš”ï¼‰
- `--rebalance`ï¼šæ¸¬è©¦çš„å†å¹³è¡¡é€±æœŸæ¸…å–®ï¼ˆé€—è™Ÿåˆ†éš”ï¼‰
- `--out`ï¼šè¼¸å‡ºæª”æ¡ˆè·¯å¾‘ï¼ˆé è¨­ï¼šoptimize_æ—¥æœŸ.csvï¼‰

```bash
# æ¸¬è©¦ä¸åŒåƒæ•¸çµ„åˆ
npm run optimize -- --start 2018-01-01 --rebalance 21,42 --top 5,10

# æŒ‡å®šè¼¸å‡ºæª”æ¡ˆ
npm run optimize -- --start 2018-01-01 --rebalance 21,42 --top 5,10,15 --out result.csv
```

- `npm run update`ï¼šæ›´æ–°è³‡æ–™åº«ï¼Œå¯æŒ‡å®šå› å­æˆ–è‚¡ç¥¨ï¼Œä½¿ç”¨ `--force` å¯å¿½ç•¥å¿«å–ã€‚

```bash
npm run update -- --factors valuation,growth --force
```

- `npm run bootstrap-pnl`ï¼šå°æ¬Šç›Šæ›²ç·šé€²è¡Œ 1000 æ¬¡ bootstrapï¼Œä¼°ç®—æœ€å¤§å›æ’¤çš„ 95% ä¿¡è³´å€é–“ã€‚

```bash
npm run bootstrap-pnl
```

## å¿«é€Ÿæµç¨‹ç¯„ä¾‹

ä»¥ä¸‹ç¯„ä¾‹ç¤ºç¯„å¾æŠ“å–è³‡æ–™åˆ°æ’åèˆ‡å›æ¸¬çš„åŸºæœ¬æµç¨‹ï¼š

1. **æŠ“å–è³‡æ–™**ï¼šä½¿ç”¨ `npm run fetch-all`ï¼ˆæˆ–å€‹åˆ¥ `fetch-*` æŒ‡ä»¤ï¼‰åˆå§‹åŒ–æœ¬åœ°è³‡æ–™åº«ã€‚

   åŸ·è¡Œå®Œç•¢å¾Œæœƒåœ¨ `data/` ä¸‹ç”Ÿæˆ SQLite æª”æ¡ˆï¼Œä¸¦æ–¼çµ‚ç«¯é¡¯ç¤ºå„ fetcher çš„é€²åº¦ã€‚

   ```bash
   npm run fetch-all
   ```

2. **è¨ˆç®—æ’å**ï¼šåŸ·è¡Œ `npm run rank` ä»¥è¼¸å‡ºä¾ç¶œåˆåˆ†æ•¸æ’åºçš„è‚¡ç¥¨åˆ—è¡¨ã€‚

   æ­¤å‘½ä»¤æœƒåœ¨çµ‚ç«¯å°å‡ºæ’è¡Œè¡¨ï¼ŒåŒ…å«è‚¡ç¥¨ä»£è™Ÿèˆ‡åˆ†æ•¸ã€‚

   ```bash
   npm run rank -- --limit 20
   ```

3. **åŸ·è¡Œå›æ¸¬**ï¼šæœ€å¾Œé€é `npm run backtest` å°æ’åç­–ç•¥é€²è¡Œæ­·å²å›æ¸¬ã€‚

   è«‹æŒ‡å®šèµ·å§‹èˆ‡çµæŸæ—¥æœŸã€æŒæœ‰æ•¸é‡å’Œå†å¹³è¡¡é€±æœŸï¼Œçµæœå°‡å­˜ç‚º `backtest_<date>.json`ï¼Œä¸¦é¡¯ç¤º CAGRã€MDD ç­‰çµ±è¨ˆã€‚

   ```bash
   npm run backtest -- --strategy rank --start 2018-01-01 --end 2020-12-31 \
     --top 10 --rebalance 21
   ```

å®Œæˆä»¥ä¸Šæ­¥é©Ÿå³å¯ç²å¾—æ’åçµæœèˆ‡å›æ¸¬å ±å‘Šï¼Œæ–¹ä¾¿å¿«é€Ÿé©—è­‰ç­–ç•¥æˆæ•ˆã€‚

## æ¸¬è©¦èˆ‡ç¨‹å¼ç¢¼å“è³ª

- `npm run test`ï¼šåŸ·è¡Œæ‰€æœ‰å–®å…ƒæ¸¬è©¦ã€‚

```bash
npm run test
```

- `npm run test:coverage`ï¼šç”¢ç”Ÿæ¸¬è©¦è¦†è“‹ç‡å ±å‘Šã€‚

```bash
npm run test:coverage
```

- `npm run test:finmind`ï¼šç·¨è­¯ä¸¦æ¸¬è©¦ FinMind API é€£ç·šã€‚

```bash
npm run test:finmind
```

- `npm run lint`ï¼šä½¿ç”¨ ESLint æª¢æŸ¥ç¨‹å¼ç¢¼ã€‚

```bash
npm run lint
```

- `npm run lint:fix`ï¼šè‡ªå‹•ä¿®æ­£ ESLint éŒ¯èª¤ã€‚

```bash
npm run lint:fix
```

- `npm run typecheck`ï¼šé€²è¡Œ TypeScript å‹åˆ¥æª¢æŸ¥ã€‚

```bash
npm run typecheck
```
